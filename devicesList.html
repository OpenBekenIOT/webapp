<!DOCTYPE html>
<html>

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Custom CSS instead of Bootstrap -->
	<link rel="stylesheet" href="styles/devicesList.css">
</head>

<body>
	<div class="wrapper">
		<div class="header">
			<div>
				<h1 style="margin-top: 0px;"><a href="https://github.com/openshwprojects/OpenBK7231T_App">OpenBeken</a> IoT
					devices teardowns database</h1>
				<h2>Powered by <a href="https://www.elektroda.com/rtvforum/forum507.html">Elektroda.com</a> teardowns
					section</h2>
			</div>
			<div>
				<a class="toggle open" href="#sidebar">
					<svg style="fill: white;" xmlns="http://www.w3.org/2000/svg" height="48" width="48"><path d="M6 36v-3h36v3Zm0-10.5v-3h36v3ZM6 15v-3h36v3Z"/></svg>
				</a>
			</div>
		</div>
		<div class="content">
			<div style="width: 100%;">
				<p>Have a device? Help us! Submit a teardown <a
						href="https://www.elektroda.com/rtvforum/forum507.html">here!</a>
				</p>
				<p>Want to get cloud-free? Pair with HA? Flash OpenBeken - now supporting BK7231N, BK7231T, XR809,
					BL602,
					T34,
					W800/W801, W600/W601!</p>
				<p>Need help? Ask <a href="https://www.elektroda.com/rtvforum/topic3866123-960.html">here!</a> Direct
					contact with
					developers, daily feedback and bugfixes!</p>
				<p>Please watch our English flashing/configuration tutorials:</p>
				<div class="evenly-iframes">
					<iframe width="100%" src="https://www.youtube.com/embed/Yb3zXtBdSnE"></iframe>
					<iframe width="100%" src="https://www.youtube.com/embed/PKkiqDNFIx8"></iframe>
					<iframe width="100%" src="https://www.youtube.com/embed/KU0tDwtjfjw"></iframe>
				</div>
				<br>
				<p>We have also Polish translations for <a href="https://www.youtube.com/watch?v=7MyfSgxLAOo">RGBCW bulb
						flashing &
						soldering tutorial</a> , <a href="https://www.youtube.com/watch?v=0V0kaRVnk18">CB2S Relay
						flashing</a>, <a href="https://www.youtube.com/watch?v=JCqq-gn-X2c">WB3S wall switch
						flashing.</a>
				</p>
				<p>Tool for BK7231T flashing: <a
						href="https://github.com/openshwprojects/OpenBK7231T/blob/master/bk_writer1.60.zip">bkWriter
						1.60</a></p>
				<p>Tool for BK7231N flashing: <a
						href="https://github.com/OpenBekenIOT/hid_download_py">hid_download_py</a>
				</p>
				<p>Click on device name to get a detailed teardown article, often with pins configuration and setup.</p>
				<p>Some devices were submitted by contributors and not by me, and might not have complete info.</p>
				<p>Also keep in mind that we have some Zigbee or TODO devices on list, just for the sake of
					completeness.
				</p>
				<p style="margin-top: 0px;" class="note">NOTE: BL0937, BL0942 and CSE7766 are chips used for energy
					metering.</p>
				<p class="note">NOTE: SM2135, BP1658 and BP5758 are "I2C" RGBCW LED drivers.</p>
				<p class="note">NOTE: Type filter "RGBCW" to find RGBCW devices, try also "4CH", "relay", try shop
					names,
					like
					"Action", "Blitzwolf", "Aubess", etc...</p>
				<p class="note">NOTE: If config template is missing, check linked topic, it may not been just entered in
					Database</p>
			</div>
			<div style="overflow: scroll;">
				<p id="demo"></p>
				<h6 id="g_state">Table is loading.</h6>
				<table>
					<thead>
						<tr>
							<th scope="col">Id</th>
							<th scope="col">Image</th>
							<th scope="col">Device Name</th>
							<th scope="col">Chipset (Module)</th>
							<th scope="col">Keywords</th>
							<th scope="col">Config</th>
							<th scope="col">Date</th>
						</tr>
					</thead>
					<tbody id="tableBody">
					</tbody>
				</table>
			</div>
		</div>
		<div class="sidebar" id="sidebar">
			<div class="menu-title">
				<h1>Menu</h1>
				<a class="toggle close" href="#">
					<svg style="fill: white;" xmlns="http://www.w3.org/2000/svg" height="48" width="48"><path d="m12.45 37.65-2.1-2.1L21.9 24 10.35 12.45l2.1-2.1L24 21.9l11.55-11.55 2.1 2.1L26.1 24l11.55 11.55-2.1 2.1L24 26.1Z"/></svg>
				</a>
			</div>
			<form onsubmit="return false;">
				<!-- <label class="sr-only" for="filter_text">Name</label> -->
				<label style="margin-bottom: 10px;display: inline-block;" for="filter_text">Keyword filter:</label>
				<br>
				<input style="margin-bottom: 10px;display: inline-block; width: 100%;" type="text"
					class="form-control mb-2" id="filter_text" placeholder="Keyword">
				<br>
				<!--  <div class="col-auto" style="display:none">
			  <label class="sr-only" for="inlineFormInputGroup">Username</label>
			  <label class="mr-sm-2" for="inlineFormCustomSelect">Keyword filter:</label>
			  <div class="input-group mb-2">
				  <select class="custom-select mr-sm-2" id="inlineFormCustomSelect">
					<option selected>All...</option>
					<option value="1">All</option>
					<option value="2">Two</option>
					<option value="3">Three</option>
				  </select>
			  </div>
			</div> -->
				<input class="form-check-input" type="checkbox" id="filter_BK7231N" checked>
				<label class="form-check-label" for="filter_BK7231N">BK7231N</label>
				<br>
				<input class="form-check-input" type="checkbox" id="filter_BK7231T" checked>
				<label class="form-check-label" for="filter_BK7231T">BK7231T</label>
				<br>
				<input class="form-check-input" type="checkbox" id="filter_XR809" checked>
				<label class="form-check-label" for="filter_XR809">XR809</label>
				<br>
				<input class="form-check-input" type="checkbox" id="filter_BL602" checked>
				<label class="form-check-label" for="filter_BL602">BL602</label>
				<br>
				<input class="form-check-input" type="checkbox" id="filter_W80X" checked>
				<label class="form-check-label" for="filter_W80X">W80X</label>
				<br>
				<input class="form-check-input" type="checkbox" id="filter_W60X" checked>
				<label class="form-check-label" for="filter_W60X">W60X</label>
				<br>
				<input class="form-check-input" type="checkbox" id="filter_ESP82XX">
				<label class="form-check-label" for="filter_ESP82XX">ESP82XX</label>
				<br>
				<input class="form-check-input" type="checkbox" id="filter_detailed">
				<label class="form-check-label" for="filter_detailed">Only show DETAILED teardowns</label>
				<div>
					<button style="width: 100%;" class="button" onclick="refreshForFilters()">Apply filtering</button>
				</div>
			</form>
		</div>
	</div>

	<script>
		var g_database;
		var getJSON = function (url, callback) {
			var xhr = new XMLHttpRequest();
			xhr.open('GET', url, true);
			xhr.responseType = 'json';
			xhr.onload = function () {
				var status = xhr.status;
				if (status === 200) {
					//alert("status is 200");
					callback(null, xhr.response);
				} else {
					alert("JSON get error? Status is " + status);
					callback(status, xhr.response);
				}
			};
			xhr.send();
		};

function processJSON(json) {
	//json = JSON.parse(json);
	if(json == null)
	{
		alert("JSON get error? JSON was NULL");
	}
	g_database = json;
	refreshJSON(g_database);
}
function refreshForFilters() {
	refreshJSON(g_database);
}
function findDocsURLForChip(chip) {

	if(chip == "BL602") 
	{
		return "http://download.bl602.fun/BL602_%E5%AE%98%E6%96%B9%E8%8A%AF%E7%89%87%E8%B5%84%E6%96%99.pdf";
	}
	
	return "";
}
//
// TODO ! ! ! Create our own boards.json and use it here
//
function findDocsURLForBoard(board) {
	if(board == "WB3S") 
	{
		return "https://developer.tuya.com/en/docs/iot/wb3s-module-datasheet?id=K9dx20n6hz5n4";
	}
	if(board == "WB2S") 
	{
		return "https://developer.tuya.com/en/docs/iot/wb2s-module-datasheet?id=K9ghecl7kc479";
	}
	if(board == "WB2L") 
	{
		return "https://developer.tuya.com/en/docs/iot/wb2l-datasheet?id=K9duegc9bualu";
	}
	if(board == "CB3S") 
	{
		return "https://developer.tuya.com/en/docs/iot/cb3s?id=Kai94mec0s076";
	}
	if(board == "CB2S") 
	{
		return "https://developer.tuya.com/en/docs/iot/cb2s-module-datasheet?id=Kafgfsa2aaypq";
	}
	if(board == "CB2L") 
	{
		return "https://developer.tuya.com/en/docs/iot/cb2l-module-datasheet?id=Kai2eku1m3pyl";
	}
	if(board == "TYWE3S") 
	{
		return "https://developer.tuya.com/en/docs/iot/wifie3smodule?id=K9605ua1cx9tv";
	}
	if(board == "TYWE2S") 
	{
		return "https://developer.tuya.com/en/docs/iot/wifie2smodule?id=K9605u79tgxug";
	}
	if(board == "WBLC5") 
	{
		return "https://developer.tuya.com/en/docs/iot/wblc5-module-datasheet?id=K9duilns1f3gi";
	}
	if(board == "WBR2") 
	{
		return "https://developer.tuya.com/en/docs/iot/wbr2-module-mcu-serial-communication-instructions?id=K9pffkcjk7q5f";
	}
	if(board == "CBLC9") 
	{
		return "https://developer.tuya.com/en/docs/iot/cblc9-module-datasheet?id=Ka42cqnj9r0i5";
	}
	if(board == "TYZS5") 
	{
		return "https://developer.tuya.com/en/docs/iot/tyzs5-zigbee-module-datasheet?id=K97gu1imy1m3u";
	}
	if(board == "CBU") 
	{
		return "https://developer.tuya.com/en/docs/iot/cbu-module-datasheet?id=Ka07pykl5dk4u";
	}
	if(board == "Z2S") 
	{
		return "https://developer.tuya.com/en/docs/iot/zs2s-datasheet?id=K97s05sctcqvy";
	}
	if(board == "CBLC5") 
	{
		return "https://developer.tuya.com/en/docs/iot/cblc5-module-datasheet?id=Ka07iqyusq1wm";
	}
	if(board == "SM-028_V1.3") 
	{
		return "https://www.elektroda.com/rtvforum/viewtopic.php?t=3945435&highlight=";
	}
	if(board == "WB2L_M1") 
	{
		return "https://www.elektroda.com/rtvforum/topic3903356.html";
	}
	if(board == "WBLC9") 
	{
		return "https://developer.tuya.com/en/docs/iot/wblc9-module-datasheet?id=K9hgglry2jp5h";
	}
	if(board == "QQQ") 
	{
		return "httQQQug";
	}
	
	return "";
}
function generateChipStr(chip, board) {
	var chipURL = findDocsURLForChip(chip);
	var chipStr;
	if(chipURL != null && chipURL.length > 0) {
		chipStr = "<a href='"+chipURL+"' target='_blank'>" + chip + "</a>";
	} else {
		chipStr = chip;
	}
	if(board == null || board.length == 0) {
	
	} else {
		var boardURL = findDocsURLForBoard(board);
		chipStr += " ";
		if(boardURL != null && boardURL.length > 0) {
			chipStr += "(<a href='"+boardURL+"' target='_blank'>" + board + "</a>)";
		} else {
			chipStr += "(" + board + ")";
		}
	}
	return chipStr;
}
function refreshJSON(json) {
 //var s = "";
  var filter_BK7231T = document.getElementById("filter_BK7231T").checked;
  var filter_text = document.getElementById("filter_text").value;
  var filter_BK7231N = document.getElementById("filter_BK7231N").checked;
  var filter_XR809 = document.getElementById("filter_XR809").checked;
  var filter_BL602 = document.getElementById("filter_BL602").checked;
  var filter_ESP82XX = document.getElementById("filter_ESP82XX").checked;
  var filter_detailed = document.getElementById("filter_detailed").checked;
  var filter_W80X = document.getElementById("filter_W80X").checked;
  var filter_W60X = document.getElementById("filter_W60X").checked;
  var g_state = document.getElementById("g_state");
  
  var cnt = 0;
  var tableBody = document.getElementById("tableBody");
  tableBody.innerHTML = '';
	var arrayLength = json.devices.length;
	for (var i = 0; i < arrayLength; i++) {
		var image = json.devices[i].image;
		var bDetailed = json.devices[i].bDetailed;
		var name = json.devices[i].name;;
		var wiki = json.devices[i].wiki;
		var chip = json.devices[i].chip;
		var board = json.devices[i].board;
		var keywords = json.devices[i].keywords;
		var vendor = json.devices[i].vendor;
		
		var chipStr = generateChipStr(chip,board);
		if(vendor == null)
		{
			vendor = "";
		}
		// if full display name has no vendor included, add italic
		if(vendor.length > 0)
		{
			if(name.toLowerCase().includes(vendor.toLowerCase()) == false)
			{
				name += " (" + vendor + ")";
			}
		}
		if(filter_BK7231T == false)
		{
			if(chip == "BK7231T")
			{
				continue;
			}
		}
		if(filter_BK7231N == false)
		{
			if(chip == "BK7231N")
			{
				continue;
			}
		}
		if(filter_XR809 == false)
		{
			if(chip == "XR809")
			{
				continue;
			}
		}
		if(filter_ESP82XX == false)
		{
			if(chip == "ESP8266" || chip == "ESP8285")
			{
				continue;
			}
		}
		if(filter_W60X == false)
		{
			if(chip == "W600" || chip == "W601")
			{
				continue;
			}
		}
		if(filter_W80X == false)
		{
			if(chip == "W800" || chip == "W801")
			{
				continue;
			}
		}
		if(filter_detailed)
		{
			// only show detailed articles
			if(wiki == null)
				continue;
			if(wiki.length == null)
				continue;
			if(bDetailed != null && bDetailed == "0")
				continue;
		}
		if(filter_BL602 == false)
		{
			if(chip == "BL602")
			{
				continue;
			}
		}
		var keywordsString = "";
		if(keywords == null)
		{
			keywords = "";
		}
		else
		{
			keywordsString = JSON.stringify(keywords);
		}
		if(wiki == null)
		{
			wiki = "";
		}
		if(filter_text != null){
			if(filter_text.length > 0)
			{
				// at least one of fields must contain
				if(name.toLowerCase().includes(filter_text.toLowerCase()) == false && chipStr.toLowerCase().includes(filter_text.toLowerCase()) == false && wiki.toLowerCase().includes(filter_text.toLowerCase()) == false && vendor.toLowerCase().includes(filter_text.toLowerCase()) == false
				 && keywordsString.toLowerCase().includes(filter_text.toLowerCase()) == false) {
					continue;
				}
			}
		}
		//Do something
		//s += "Device " + i + " out of " + arrayLength + " is "
		//s += name;
		//s += "<br>";
		
		
		var tr = document.createElement('tr');   

				var th = document.createElement('th');
				var td1 = document.createElement('td');
				var td2 = document.createElement('td');
				var td3 = document.createElement('td');
				var td4 = document.createElement('td');
				var td5 = document.createElement('td');

		var img = document.createElement('img');
		
		var a = document.createElement('a');
		if(wiki.length > 0) {
			a.href = wiki;
		} else {
			a.href = "#";
			a.onclick = function() {alert('Sorry, the contributor didnt add link to Elektroda. If you have this device, please take some photos and it to our forums, and we will update this database later.'); return false; };
		}
		a.target = "blank";
		a.innerHTML = name;
		td1.appendChild(img);
		
		th.innerHTML = cnt;
		td1.class = "w-25";
		img.class = "img-fluid img-thumbnail";
		img.width = 200;
		img.src = image;
		td2.appendChild(a);
		td3.innerHTML = chipStr;
		td4.innerHTML = keywords;
		tr.appendChild(th);
		tr.appendChild(td1);
		tr.appendChild(td2);
		tr.appendChild(td3);
		tr.appendChild(td4);
		tr.appendChild(td5);

				tableBody.appendChild(tr);
				cnt++;
			}
			g_state.innerHTML = "Showing " + cnt + " out of " + arrayLength + " devices.";
			//document.getElementById("demo").innerHTML = s;

		}

		getJSON('https://openbekeniot.github.io/webapp/devices.json',
			function (err, data) {
				if (err !== null) {
					alert('Something went wrong: ' + err);
				} else {
					//alert('Your query count: ' + data);
					processJSON(data);
				}
			});

	</script>
</body>

</html>